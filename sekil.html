<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giriş Sayfası</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .login-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .phone-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .phone-grid div {
            width: 60px;
            height: 60px;
            background-color: #e0e0e0;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .phone-grid div::after {
            content: "";
            width: 10px;
            height: 10px;
            background-color: #333;
            border-radius: 50%;
        }
        .line {
            position: absolute;
            height: 2px;
            background-color: #007bff;
            transform-origin: 0 0;
        }
        .iframe-container {
            display: none;
            width: 100%;
            height: 100vh;
            border: none;
        }
    </style>
</head>
<body>

<div class="login-container" id="loginContainer">
    <div class="phone-grid">
        <div data-key="1"></div>
        <div data-key="2"></div>
        <div data-key="3"></div>
        <div data-key="4"></div>
        <div data-key="5"></div>
        <div data-key="6"></div>
        <div data-key="7"></div>
        <div data-key="8"></div>
        <div data-key="9"></div>
    </div>
</div>

<div class="iframe-container" id="iframeContainer">
    <iframe src="" id="contentFrame" width="100%" height="100%"></iframe>
</div>

<script>
    const correctSequence = ["2", "5", "6", "8"]; // Doğru tuş sırası
    let userSequence = [];
    let isDrawing = false;
    let lines = [];

    const phoneGrid = document.querySelector(".phone-grid");

    // Fare ve dokunmatik olaylarını dinle
    phoneGrid.addEventListener("mousedown", startDrawing);
    phoneGrid.addEventListener("touchstart", startDrawing);

    phoneGrid.addEventListener("mouseover", draw);
    phoneGrid.addEventListener("touchmove", draw);

    document.addEventListener("mouseup", endDrawing);
    document.addEventListener("touchend", endDrawing);

    function startDrawing(e) {
        e.preventDefault();
        isDrawing = true;
        const key = getKeyFromEvent(e);
        if (key) {
            userSequence = [key];
            document.querySelector(`[data-key="${key}"]`).classList.add("active");
        }
    }

    function draw(e) {
        if (isDrawing) {
            const key = getKeyFromEvent(e);
            if (key && !userSequence.includes(key)) {
                userSequence.push(key);
                document.querySelector(`[data-key="${key}"]`).classList.add("active");

                // Çizgi çizme
                const activeKeys = document.querySelectorAll(".active");
                if (activeKeys.length > 1) {
                    const prevKey = activeKeys[activeKeys.length - 2];
                    const currentKey = activeKeys[activeKeys.length - 1];

                    const prevRect = prevKey.getBoundingClientRect();
                    const currentRect = currentKey.getBoundingClientRect();

                    const line = document.createElement("div");
                    line.classList.add("line");
                    line.style.width = `${Math.hypot(
                        currentRect.left - prevRect.left,
                        currentRect.top - prevRect.top
                    )}px`;
                    line.style.transform = `rotate(${Math.atan2(
                        currentRect.top - prevRect.top,
                        currentRect.left - prevRect.left
                    )}rad)`;
                    line.style.top = `${prevRect.top + prevRect.height / 2}px`;
                    line.style.left = `${prevRect.left + prevRect.width / 2}px`;

                    phoneGrid.appendChild(line);
                    lines.push(line);
                }
            }
        }
    }

    function endDrawing() {
        if (isDrawing) {
            isDrawing = false;

            // Doğrulama
            if (JSON.stringify(userSequence) === JSON.stringify(correctSequence)) {
                document.getElementById("loginContainer").style.display = "none";
                document.getElementById("iframeContainer").style.display = "block";
                document.getElementById("contentFrame").src = "https://my.cbox.ws";
            } else {
                alert("Hatalı Şekil! Lütfen tekrar deneyin.");
                resetGrid();
            }
        }
    }

    function resetGrid() {
        userSequence = [];
        document.querySelectorAll(".phone-grid div").forEach((div) => {
            div.classList.remove("active");
        });
        lines.forEach((line) => line.remove());
        lines = [];
    }

    function getKeyFromEvent(e) {
        if (e.type.startsWith("touch")) {
            const touch = e.touches[0];
            const element = document.elementFromPoint(touch.clientX, touch.clientY);
            return element ? element.dataset.key : null;
        } else {
            return e.target.dataset.key;
        }
    }
</script>

</body>
</html>